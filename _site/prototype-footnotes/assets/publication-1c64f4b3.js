import{_ as H}from"./DocumentUnitWrapper.vue_vue_type_script_setup_true_lang-c12920d0.js";import{d as $,H as A,i as f,a as n,c as u,f as e,k as m,F as R,r as S,t as b,h as U,b as M,g as w,w as z,T as I,a3 as Y,n as q,y as O,l as k,Y as B,m as T,A as Z,B as J,C as K,D as Q,G as W,j as ee}from"./index-086108b4.js";import{C as te}from"./CodeSnippet-770cd160.js";import{f as se}from"./coreDataFields-e5e2789f.js";import{_ as j,I as le}from"./InfoModal.vue_vue_type_script_setup_true_lang-e56f4d05.js";import{d as ne}from"./documentUnitService-4c93048b.js";import"./dayjs.min-633259b2.js";import"./useToggleStateInRouteQuery-529f287a.js";import"./SideToggle.vue_vue_type_script_setup_true_lang-24f80c0e.js";import"./types-7b85aa56.js";import"./documentUnit-2521476f.js";const ie={court:"Gericht",date:"Entscheidungsdatum",fileNumber:"Aktenzeichen",documentType:"Dokumenttyp"},ae={class:"flex flex-col flex-start gap-40 justify-start max-w-[42rem]"},oe=e("h1",{class:"heading-02-regular"},"Veröffentlichen",-1),re={"aria-label":"Plausibilitätsprüfung",class:"flex flex-row gap-16"},ue=e("div",{class:"w-[15.625rem]"},[e("p",{class:"subheading"},"1. Plausibilitätsprüfung")],-1),ce={key:0,class:"flex flex-row gap-8"},de=e("div",null,[e("span",{class:"bg-red-800 material-icons rounded-full text-white"}," error ")],-1),me={class:"flex flex-col gap-32"},fe=e("p",{class:"body-01-reg"}," Die folgenden Rubriken-Pflichtfelder sind nicht befüllt: ",-1),he={class:"list-disc"},be={key:0,class:"body-01-reg list-item ml-[1rem]"},pe={key:0},_e={class:"label-02-bold"},ge={key:1,class:"flex flex-row gap-8"},ve=e("span",{class:"material-icons text-green-700"}," check ",-1),xe=e("p",{class:"body-01-reg"},"Alle Pflichtfelder sind korrekt ausgefüllt",-1),ye=[ve,xe],De=e("div",{class:"border-b-1 border-b-gray-400"},null,-1),ke={class:"flex flex-row gap-16"},Me=e("div",{class:"w-[15.625rem]"},[e("p",{class:"subheading"},"2. Empfänger der Export-Email")],-1),we={class:"grow"},Ee=e("div",{class:"border-b-1 border-b-gray-400"},null,-1),Pe={"aria-label":"Letzte Veröffentlichungen",class:"flex flex-col gap-24"},Ae=e("h2",{class:"heading-03-regular"},"Letzte Veröffentlichungen",-1),Ue={key:0},ze={key:1,class:"flex flex-col gap-24"},$e={class:"label-02-regular"},Ce=e("div",{class:"label-section text-gray-900"},"ÜBER",-1),Fe={class:"label-02-regular"},Le=e("span",{class:"label-02-bold"},"E-Mail an:",-1),Ve=e("span",{class:"label-02-bold"}," Betreff: ",-1),Ne=e("div",{class:"label-section text-gray-900"},"ALS",-1),Xe=$({__name:"PublicationDocument",props:{documentUnit:null,publishResult:null,lastPublishedXmlMail:null,errorMessage:null,succeedMessage:null},emits:["publishADocument"],setup(i,{emit:a}){var C;const t=i,s=A(()=>({name:"caselaw-documentUnit-:documentNumber-categories",params:{documentNumber:t.documentUnit.documentNumber}})),c=f("dokmbx@juris.de"),h=f(!1),g=A(()=>!t.lastPublishedXmlMail),p=f(),x=A(()=>p.value??t.errorMessage);function o(){E.value&&(p.value={title:"Es sind noch nicht alle Pflichtfelder befüllt.",description:"Die Dokumentationseinheit kann nicht veröffentlicht werden."}),l()?(h.value=!1,a("publishADocument",c.value)):h.value=!0}function l(){return/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(c.value)}function _(r){r.target.select()}const y=f(t.documentUnit.missingRequiredFields.map(r=>se[r])),v=f((C=t.documentUnit.proceedingDecisions)==null?void 0:C.filter(r=>P(r).length>0).map(r=>({identifier:r.renderDecision,missingFields:P(r)}))),E=A(()=>{var r;return!!(y.value.length||(r=v.value)!=null&&r.length)});function P(r){return r.missingRequiredFields.map(D=>ie[D])}return(r,D)=>{var F,L,V,N,X;return n(),u("div",ae,[oe,e("div",re,[ue,m(E)?(n(),u("div",ce,[de,e("div",me,[e("div",null,[fe,e("ul",he,[(n(!0),u(R,null,S(y.value,d=>(n(),u("li",{key:d,class:"body-01-reg list-item ml-[1rem]"},b(d),1))),128)),v.value&&v.value.length>0?(n(),u("li",be,[U(" Rechtszug "),e("ul",null,[(n(!0),u(R,null,S(v.value,d=>(n(),u("li",{key:v.value.indexOf(d),class:"body-01-reg list-item ml-[1rem]"},[d&&d.missingFields.length>0?(n(),u("div",pe,[e("span",null,b(d.identifier),1),U(" - "),e("span",_e,b(d.missingFields.join(", ")),1)])):M("",!0)]))),128))])])):M("",!0)])]),w(m(Y),{to:m(s)},{default:z(()=>[w(I,{"aria-label":"Rubriken bearbeiten","button-type":"tertiary",class:"w-fit",label:"Rubriken bearbeiten"})]),_:1},8,["to"])])])):(n(),u("div",ge,ye))]),De,e("div",ke,[Me,e("div",we,[w(O,{id:"receiverAddress",key:"receiverAddress","error-message":h.value?"E-Mail-Adresse ungültig":void 0,label:"Empfänger-E-Mail-Adresse:"},{default:z(()=>[w(q,{id:"receiverAddress",modelValue:c.value,"onUpdate:modelValue":D[0]||(D[0]=d=>c.value=d),"aria-label":"Empfängeradresse E-Mail",onFocus:D[1]||(D[1]=d=>_(d))},null,8,["modelValue"])]),_:1},8,["error-message"])])]),Ee,m(x)?(n(),k(j,B({key:0,"aria-label":"Fehler bei Veröffentlichung",class:"mt-8"},m(x)),null,16)):M("",!0),i.succeedMessage?(n(),k(j,B({key:1,"aria-label":"Erfolg der Veröffentlichung",class:"mt-8"},i.succeedMessage,{status:m(le).SUCCEED}),null,16,["status"])):M("",!0),w(I,{"aria-label":"Dokumentationseinheit veröffentlichen","button-type":"secondary",class:"w-fit",icon:"campaign",label:"Dokumentationseinheit veröffentlichen",onClick:o}),e("div",Pe,[Ae,m(g)?(n(),u("p",Ue," Diese Dokumentationseinheit wurde bisher nicht veröffentlicht ")):(n(),u("div",ze,[e("div",$e," Letzte Veröffentlichung am "+b((F=t.lastPublishedXmlMail)==null?void 0:F.publishDate)+" (Zustellung: "+b((L=t.lastPublishedXmlMail)==null?void 0:L.publishStateDisplayText)+") ",1),Ce,e("div",Fe,[e("div",null,[Le,U(" "+b((V=t.lastPublishedXmlMail)==null?void 0:V.receiverAddress),1)]),e("div",null,[Ve,U(" "+b((N=t.lastPublishedXmlMail)==null?void 0:N.mailSubject),1)])]),Ne,(X=t.lastPublishedXmlMail)!=null&&X.xml?(n(),k(te,{key:0,title:"XML",xml:t.lastPublishedXmlMail.xml},null,8,["xml"])):M("",!0)]))])])}}}),Re={async publishDocument(i,a){var s,c;const t=await T.put(`caselaw/documentunits/${i}/publish`,{headers:{"Content-Type":"text/plain"}},a);return(t.status>=300||Number((s=t.data)==null?void 0:s.statusCode)>=300)&&(t.status=(c=t.data)!=null&&c.statusCode?Number(t.data.statusCode):t.status,t.error={title:"Leider ist ein Fehler aufgetreten.",description:"Die Dokumentationseinheit kann nicht veröffentlicht werden."}),t},async getLastPublishedXML(i){const a=await T.get(`caselaw/documentunits/${i}/publish`);return a.error=a.status>=300?{title:"Fehler beim Laden der letzten Veröffentlichung",description:"Die Daten der letzten Veröffentlichung konnten nicht geladen werden."}:void 0,a}},G=Re,Se=i=>(K("data-v-0cf163bb"),i=i(),Q(),i),Ie={key:1,class:"spinner"},Be=Se(()=>e("h2",null,"Überprüfung der Daten ...",-1)),Te=[Be],je=$({__name:"DocumentUnitPublication",props:{documentUnit:null},setup(i){const a=i,t=f(!1),s=f(),c=f(),h=f(),g=f();async function p(o){var _;const l=await G.publishDocument(a.documentUnit.uuid,o);c.value=l.data,l.data&&Number((_=l.data)==null?void 0:_.statusCode)<300?(s.value=l.data,s.value.publishDate=x(s.value.publishDate),s.value.xml=s.value.xml?s.value.xml.replace(/[ \t]{2,}/g,""):"",g.value={title:"Email wurde versendet",description:""}):h.value=l.error}function x(o){if(!o)return"";const l=new Date(o),_=l.getFullYear(),y=("0"+(l.getMonth()+1)).slice(-2),v=("0"+l.getDate()).slice(-2),E=("0"+l.getHours()).slice(-2),P=("0"+l.getMinutes()).slice(-2);return`${v}.${y}.${_} um ${E}:${P} Uhr`}return Z(async()=>{const o=await G.getLastPublishedXML(a.documentUnit.uuid);if(o.error){t.value=!0;return}o.data&&(s.value=o.data),s.value&&(s.value.publishDate=x(s.value.publishDate),s.value.xml=s.value.xml?s.value.xml:""),h.value=o.error,t.value=!0}),(o,l)=>(n(),k(H,{"document-unit":i.documentUnit},{default:z(({classes:_})=>[e("div",{class:J(_)},[t.value?(n(),k(Xe,{key:0,"document-unit":i.documentUnit,"error-message":h.value,"last-published-xml-mail":s.value,"publish-result":c.value,"succeed-message":g.value,onPublishADocument:l[0]||(l[0]=y=>p(y))},null,8,["document-unit","error-message","last-published-xml-mail","publish-result","succeed-message"])):(n(),u("div",Ie,Te))],2)]),_:1},8,["document-unit"]))}});const Ge=W(je,[["__scopeId","data-v-0cf163bb"]]),He={key:1},lt=$({__name:"publication",props:{documentNumber:null},async setup(i){let a,t;const s=i;async function c(){const p=await ne.getByDocumentNumber(s.documentNumber);return{documentUnit:f(p.data),error:p.error}}const{documentUnit:h,error:g}=([a,t]=ee(()=>c()),a=await a,t(),a);return(p,x)=>{var o,l;return m(h)?(n(),k(Ge,{key:0,"document-unit":m(h)},null,8,["document-unit"])):(n(),u("div",He,[e("h2",null,b((o=m(g))==null?void 0:o.title),1),e("p",null,b((l=m(g))==null?void 0:l.description),1)]))}}});export{lt as default};
